## **Links**
- https://de.wikipedia.org/wiki/IPv4

##  **IPv4 Aufbau**
4 byte = 32 bit, 4 segmente
2^32 = 4 billionen Addressen (Mittlerweile zu wenige)

Ursprünglich aufgeteilt in 3 teile:
- Klasse (verschiedene Netzgrößen)
	- A: Prefix "0"; 7 bit Netz / 24 bit Rechner
	- B: Prefix "10"; 14 bit Netz / 16 bit Rechner
	- C: Prefix "110"; 21 bit Netz / 8 bit Rechner
	- (D: Prefix "1110"; 28 bit multicast; nur Lokal Gültig)
	- (E: Prefix "1111"; +28 bit, Reserviert)
- Netzadresse
- Rechner-/Hostadresse

Netzmaske = Bereich der Netzaddresse + Klasse hat 1-bits
z.B. 255.255.255.0 -> nur letzte 8 bit für Rechner

Gerichtete Broadcast-Addresse: Hostteil = nur 1er bits
- "Alle Rechner in dem Netz"
Begrenzte Broadcast-Addresse: nur 1er bits
- 255.255.255.255
- "Alle Rechner im Lokalen Netz"
Loopback-Addresse: Präfix 127
- 127.0.0.1; 127.123.123.123
- "An den eigenen Rechner"
Konvention: Router erhalten Hostteil addresse 1
- 192.168.0.1
Private IP-netze
- nicht Routed
- A: 10.0.0.0 - 10.255.255.255
- B (16 möglich): 172.x.0.0 - 127.x+15.255.255
- C (255 möglich): 192.x.0.0 - 192.x.255.255

Weil addressen immer knapper wurde, sollten irgendwann mehr als 3 Netzgrößen möglich sein.
Seitdem werden immer IP-Addresse und Netzmaske (als anzahl der Netzaddressbits) geschrieben:
- 12.10.1.64/26
	- Wäre eigendlich ein Class-A Netz
	- 26 bit netz, 6 bit rechner
## **CIDR: Classless Inter-Domain Routing**
- Mit CIDR wurde das starre Klassensystem (A, B, C) aufgehoben, um Netze flexibler und bedarfsgerechter aufteilen zu können.
- Jede IP-Adresse besteht weiterhin aus einem Netz- und einem Hostanteil, jedoch ist die Länge des Netzpräfixes nun variabel
- Eine CIDR-Adresse besteht aus der IP-Adresse und der Präfixlänge (Anzahl der Netzbits), z. B. 12.10.1.64/26.
- Früher hätte die Adresse 12.x.x.x zu einem Klasse-A-Netz gehört, unter CIDR weist jedoch allein die Präfixlänge auf die Netzgröße hin. 
- Im Beispiel bedeutet /26: 26 Bit für den Netzanteil, 6 Bit für den Hostanteil.
## **IP Header**
- **Version**: 4/6
- **IHL (Internet Header Lenght)**:
	- Länger des IPv4-Headers in 32 Bit worten.
	-  Normalerweise IHL = 5 -> x 4 Byte = 20 Byte (keine Optionen)
- **ToS (Type of Service)**:
	- Heute als **Differentiated Services Code Point (DSCP)** und **Explicit Congestion Notification (ECN)** genutzt.
- **Kennung (Identification)**: 
	- 16-Bit-Wert zur Identifizierung (Nummerierung) der Fragmente eines Datagramms. Alle Fragmente desselben Pakets tragen die gleiche Kennung.
- **Flags**:
	- 3 Steuerbits zur Kontrolle der Fragmentierung
	- DF = 1 "do not fragment"
	- MF = 1 "more fragments exist"
- **Fragment Offset:**
	- Position des Fragments im ursprünglichen Datagramm, angegeben in 8-Byte-Einheiten (13 Bit).
- **TTL (Time To Live)**:
	- Wird vom router decremented
	- TTL = 0 -> paket wird verworfen
	- Vorsorge gegen z.B. im kreis routen
	- Anmerkung: Ursprünglich als Zeitangabe in Sekunden gedacht, heute als Hop-Zähler interpretiert. Typischer Startwert: z. B. 64.
- **Protokoll:**
	- 8-Bit-Wert zur Identifizierung des darüberliegenden Transportprotokolls (entspricht der IANA Protocol Number).
	- Oft: 6 = TCP, 17 = UDP
- **Kopfprüfsumme (Header Checksum):**
	- 16-Bit-Prüfsumme über den IPv4-Header (ohne Nutzdaten). Sie wird bei jedem Hop von Routern überprüft und neu berechnet.
- **Optionen:**
	- Variabel langes Feld (optional), heute kaum noch genutzt. Beispiel: Option 7 (Record Route) – Router tragen ihre IP-Adressen in das Optionsfeld ein. (Falls nötig, wird das Feld auf ein Vielfaches von 32 Bit aufgefüllt.)

## **Subnetting**
Router benötigt pro Interface eine eigene Netzaddresse.
Broadcasts sollten in größeren Organisationen nicht an alle Clients gehen.

Kleinere Teilnetze/Subnetze werden im Vorgegebenen Addressbereich definiert.
Bits die zur Kodierung der Rechneraddresse vorgesehen sind, werden für Addressierung von Teilnetzen verwendet.

Zu Beachten:
- Anzahl der benötigten Subnetze
- Anzahl der Rechner im größten Subnetz
## **Address Resolution Protocol (ARP)**
In den verschiedenen Schichten des Netzwerkmodells werden unterschiedliche Arten von Adressen bzw. Namen verwendet: 
- **MAC-Adressen** – 48-Bit-Adressen der Sicherungsschicht (Data Link Layer)
-  **IP-Adressen** – 32-Bit-IPv4-Adressen der Vermittlungsschicht (Network Layer) 
- **Fully Qualified Domain Names (FQDN)** – z. B. www.h-brs.de, verwendet auf der Anwendungsschicht
Auflösung:
Das DNS löst den FQDN in eine IP Adresse auf.
Die Zuordnung von IP-Adresse zu MAC-Adresse erfolgt über das Address Resolution Protocol (ARP). 
FQDN -> IP Address -> MAC Adress
- Zur Ermittlung einer **IP-Adresse** aus einer bekannten **MAC-Adresse** wurde früher das Reverse **Address Resolution Protocol** **(RARP)** verwendet. Heute übernehmen diese Funktion Protokolle wie **BOOTP** oder **DHCP**. 
- Auch das **Domain Name System (DNS)** unterstützt eine Auflösung in umgekehrter Richtung: Mit **Reverse DNS** kann zu einer IP-Adresse der zugehörige Domainname ermittelt werden
**Hinweis: ARP funktioniert nur innerhalb desselben lokalen Netzes (Broadcast-Domäne).**
Steps:
1. Überprüfen, ob die benötigte Zuordnung (IP zu MAC) bereits im lokalen ARP-Cache vorhanden ist. 
	- Falls ja: Die gespeicherte MAC-Adresse wird verwendet.
	- Falls nein: Weiter mit Schritt 2.
2. Senden einer ARP-Request-Nachricht als Broadcast (Ziel-MAC-Adresse: FF:FF:FF:FF:FF:FF) an alle Geräte im lokalen Netz. Enthalten ist die gesuchte Ziel-IP-Adresse.
3. Alle Geräte im Netzwerk prüfen, ob die angefragte IP-Adresse zu ihrer eigenen gehört.
4. Nur das Gerät mit der passenden IP-Adresse antwortet mit einer ARP-Reply-Nachricht und teilt seine MAC-Adresse mit.
5. Der Absender speichert die Zuordnung von IP- und MAC-Adresse im ARP-Cache.
6. Das Datenpaket kann nun an die ermittelte MAC-Adresse gesendet werden.
## **Internet Control Message Protocol (ICMP)**

ICMP wird der IP-Schicht (Layer 3) zugeordnet und dient der Übermittlung von Fehler- und Statusmeldungen zwischen Netzwerkteilnehmern.

Die ICMP-Nachricht folgt direkt auf den IP-Header und ist durch eine Prüfsumme geschützt.

Jede ICMP-Nachricht ist durch ein Typfeld und ggf. ein Codefeld eindeutig gekennzeichnet.

| Typ | Name                    | Beschreibung/Verwendun                                                                       |
| :-: | ----------------------- | -------------------------------------------------------------------------------------------- |
|  0  | Echo Reply              | Antwort auf einen Echo Reqeuest (z.B. `ping`)                                                |
|  3  | Sestination Unreachable | Ziel nicht erreichbar. Verschiedene Codes geben genauere Ursache an (Netz, Host, Port, etc.) |
|  5  | Redirect                | Hinweis auf besseren Router – selten verwendet, oft durch Firewalls geblockt                 |
|  8  | Echo Request            | Erreichbarkeitsprüfung über ping; sendet ICMP- Anfrage                                       |
| 11  | Time Exceeded           | TTL überschritten – genutzt z. B. von traceroute zur Pfadverfolgung                          |
| 12  | Parameter Problem       | Fehlerhafte oder ungültige Header-Felder erkannt                                             |

| ICMP Type | Bedeutung                   |
| :-------: | --------------------------- |
|     0     | Netzwerk unerreichbar       |
|     1     | Rechner unerreichbar        |
|     2     | Protokoll unerreichbar      |
|     3     | Port unerreichbar           |
|     4     | Fragmentierung erforderlich |
|     6     | Zielnetzwerk unbekannt      |

