Transmission Control Protocol (TCP)
- ÃœbertrÃ¤gt Daten zuverlÃ¤ssig Ã¼ber ein unzuverlÃ¤ssige IP-Netz
	- Effektiv gegen
		- Verlorene Daten
		- Korrupte Daten
		- Vertauschte Reihenfolge der Daten
		- Duplikate
- Ã–ffnet eine Verbindung, bevor die Ãœbertragung beginnt
- Reguliert Datenfluss, um Ã¼berlastung des Netzes zu vermeiden
- TCP ist Verbindungsorientiert

## **3 Way Handshake**
Verbindungsaufbau mit 3-Way-Handshake
- SYN -> SYN-ACK -> ACK
DatenÃ¼bertragung â€“ bidirektional (full-duplex)
Verbindungsabbau (4-Wege-Handshake)
- FIN/ACK (kann von beiden Seiten ausgehen)
- SEQ = Sequence Number
- ISN = Initial Sequence Number
- ACK = Acknowledgement Number
- Kann von beiden Parteien initiiert werden
- SchlieÃŸen einer Richtung mÃ¶glich (half-close)

TCP ist byte orientiert, nicht Paket orientiert
Aus sicht der Anwendung nur ein fortlaufender Bytestream
TCP Ã¼bertrÃ¤gt diesen in Segmenten

Ein Segment wird gesendet wenn
- Das Segment voll ist
- Ein Timeout ablÃ¤uft
- Die Applikation ein Signal gibt
## **ZuverlÃ¤ssigkeit**
- Daten werden korrekt Ã¼bermittelt (oder garnicht)
- Daten werden vollstÃ¤ndig Ã¼bermittelt
- Duplikate werden eliminiert
- Daten werden in der korrekten Reihenfolge Ã¼bertragen

### **Typische Fehler und GegenmaÃŸnamen**
- Bitfehler -> Internet Checksum
- Verlust kompletter Nachrichten -> Fehlende BestÃ¤tigung (**ACK**nowledgement)
- Duplikate -> Sequenznummer
- Falsche Reihenfolge -> Sequenznummer

**Automatic Repeat reQuest (ARQ)**
- Sender fordert vom EmpfÃ¤nger eine BestÃ¤tigung (ACK), dass die Daten korrekt empfangen wurden
- Nach Timeout ohne ACk wird das Paket erneut gesendet

Sendet man die nÃ¤chste Nachricht erst, wenn die vorherige erfolgreich Ã¼bertragen wurde, spricht man von "Stop-and-Wait"
- Sehr ineffizient bei kleinen Paketen und hohem Ping

Besser als Stop-and-Wait: Sliding Window
- Sender darf nicht nur ein Segment versenden, sondern N bevor ein ACK erwartet wird
- Wenn Segmente fortlaufend nummeriert werden (Sequenznummer) entsteht ein "Window" welches die aktuell versendeten Segmente angibt
- Sobald ein Paket bestÃ¤tigt wird, verschiebt sich Anfang und Ende des Window
	- Es entsteht ein "Sliding Window"

Was tut man bei Ãœbertragungsfehlern
- Go-Back-N
	- EmpfÃ¤nger:
		- Wenn Segment mit `seq=n` empfangen wird und Reihenfolge korrekt ist, sende `ACK(n)`
		- Bei falscher Sequenznummer, `seq=n+2` sende weiterhin `ACK(n)` bis `seq=n+1` eintrifft
	- Sehr einfach (kein puffer)
	- Verlust von einem Segment fÃ¼hrt zu vielen unnÃ¶tigen Wiederholungen
- Selective Repeat
	- EmpfÃ¤nger:
		- Individuelle BestÃ¤tigung von jedem Segment das Eintrifft, selbst bei falscher Reihenfolge
		- Empfangspuffer um auf fehlende Segmente warten zu kÃ¶nnen

## **Timeout und Round Trip Time (RTT)**
Wahl des Timeouts
- LÃ¤nger als RTT, aber RTT variiert
- Zu kurz -> UnnÃ¶tig verworfene Segmente
- Zu lang -> Langsame Reaktion bei Fehlern
RTT wird kontinuierlich gemessen, Ã¼ber vergangene erfolgreiche ACKs
`EstimatedRTT = (1-a)*EstimatedRTT + a*SampleRTT`
mit `a` um 0.125

ARQ in der RealitÃ¤t:
- Nicht Segmente sondern Bytes werden bestÃ¤tigt
	- `seq` erhÃ¶ht sich immer um die LÃ¤nge des gesendeten Pakets
		- `seq=1,len=10` -> `seq=11,len=...`
- Es existieren verschiedene TCP-Implementierungen die entweder Go-Back-N, Selective Repeat oder eine Kombination verwenden
## **Flow Control**
- Situation: Der Sender Ã¼bertrÃ¤gt Daten schneller, als der Prozess auf EmpfÃ¤ngerseite sie aus dem Puffer lesen kann (ğœ†ğ‘–ğ‘› > ğœ†ğ‘œğ‘¢ğ‘¡). 
- Folge: Der Empfangspuffer kann Ã¼berlaufen; Segmente wÃ¼rden verworfen â†’ unnÃ¶tige Wiederholungen. 
- LÃ¶sungsansatz: Der EmpfÃ¤nger informiert den Sender Ã¼ber den aktuell verfÃ¼gbaren freien Pufferplatz. 
- Ziel: Der EmpfÃ¤nger steuert die Sendegeschwindigkeit des Senders.
1. Der EmpfÃ¤nger teilt die GrÃ¶ÃŸe des aktuell freien Puffers (receive window (rwnd)) im Window Feld des TCP headers dem Sender mit 
2. Sender limitiert sein Sendefenster basierend auf der GrÃ¶ÃŸe des Puffers beim EmpfÃ¤nger

## **Congestion Control**
- Situation: Viele Sender Ã¼bertragen gleichzeitig so viele Daten, dass das Netzwerk Ã¼berlastet wird. 
- Folgen: Lange VerzÃ¶gerungszeiten durch wachsende Warteschlangen in Routern 
- Paketverluste aufgrund Ã¼berlaufender Routerpuffer Paketverluste fÃ¼hren zu wiederholten Ãœbertragungen â€“ was die Stausituation weiter verschÃ¤rft
- komplexer als Flow Control, da nicht nur Sender und EmpfÃ¤nger, sondern das gesamte Netzwerkverhalten berÃ¼cksichtigt werden muss.