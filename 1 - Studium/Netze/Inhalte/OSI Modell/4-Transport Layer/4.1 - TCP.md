Transmission Control Protocol

TCP
- Überträgt Daten zuverlässig über unzuverlässige IP-Netze
	- Effektiv gegen
		- Verlorene Daten
		- Korrupte Daten
		- Vertauschte Reihenfolge der Daten
		- Duplikate
- Öffnet eine Verbindung, bevor die Übertragung beginnt
- Reguliert Datenfluss, um überlastung des Netzes zu vermeiden

#### Verbindung
TCP ist Verbindungsorientiert

Verbindungsaufbau mit 3-Way-Handshake
- SYN, SYN-ACK, ACK
Datenübertragung (Bidirektional)
Verbindungsabbau
- FIN (kann von beiden Seiten ausgehen)
- seq = Sequence Number
- isn = Initial Sequence Number
- ack = Acknowledgement Number

TCP ist byte orientiert, nicht Paket orientiert
Aus sicht der Anwendung nur ein fortlaufender Bytestream
TCP überträgt diesen in Segmenten

Ein Segment wird gesendet wenn
- Das Segment voll ist
- Ein Timeout abläuft
- Die Applikation ein Signal gibt
#### Zuverlässigkeit
- Daten werden korrekt übermittelt (oder garnicht)
- Daten werden vollständig übermittelt
- Duplikate werden eliminiert
- Daten werden in der korrekten Reihenfolge übertragen

Typische Fehler und Gegenmaßnamen
- Bitfehler -> Internet Checksum
- Verlust kompletter Nachrichten -> Fehlende Bestätigung (**ACK**nowledgement)
- Duplikate -> Sequenznummer
- Falsche Reihenfolge -> Sequenznummer

Automatic Repeat reQuest (ARQ)
- Sender fordert vom Empfänger eine Bestätigung (ACK), dass die Daten korrekt empfangen wurden
- Nach Timeout ohne ACk wird das Paket erneut gesendet

Sendet man die nächste Nachricht erst, wenn die vorherige erfolgreich übertragen wurde, spricht man von "Stop-and-Wait"
- Sehr ineffizient bei kleinen Paketen und hohem Ping

Besser als Stop-and-Wait: Sliding Window
- Sender darf nicht nur ein Segment versenden, sondern N bevor ein ACK erwartet wird
- Wenn Segmente fortlaufend nummeriert werden (Sequenznummer) entsteht ein "Window" welches die aktuell versendeten Segmente angibt
- Sobald ein Paket bestätigt wird, verschiebt sich Anfang und Ende des Window
	- Es entsteht ein "Sliding Window"

Was tut man bei Übertragungsfehlern
- Go-Back-N
	- Empfänger:
		- Wenn Segment mit `seq=n` empfangen wird und Reihenfolge korrekt ist, sende `ACK(n)`
		- Bei falscher Sequenznummer, `seq=n+2` sende weiterhin `ACK(n)` bis `seq=n+1` eintrifft
	- Sehr einfach (kein puffer)
	- Verlust von einem Segment führt zu vielen unnötigen Wiederholungen
- Selective Repeat
	- Empfänger:
		- Individuelle Bestätigung von jedem Segment das Eintrifft, selbst bei falscher Reihenfolge
		- Empfangspuffer um auf fehlende Segmente warten zu können

Timeout und Round Trip Time (RTT)
Wahl des Timeouts
- Länger als RTT, aber RTT variiert
- Zu kurz -> Unnötig verworfene Segmente
- Zu lang -> Langsame Reaktion bei Fehlern
RTT wird kontinuierlich gemessen, über vergangene erfolgreiche ACKs
`EstimatedRTT = (1-a)*EstimatedRTT + a*SampleRTT`
mit `a` um 0.125

ARQ in der Realität:
- Nicht Segmente sondern Bytes werden bestätigt
	- `seq` erhöht sich immer um die Länge des gesendeten Pakets
		- `seq=1,len=10` -> `seq=11,len=...`
- Es existieren verschiedene TCP-Implementierungen die entweder Go-Back-N, Selective Repeat oder eine Kombination verwenden